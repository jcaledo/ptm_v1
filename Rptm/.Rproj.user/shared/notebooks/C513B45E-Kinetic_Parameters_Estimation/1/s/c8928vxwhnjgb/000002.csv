"0","ecb <- function(data, unit_S = 'mM', unit_v = 'au', plot = TRUE){"
"0",""
"0","  ## -------------------- Variables' names ---------------------- ##"
"0","  colnames(data)[1] <- 'S'"
"0","  colnames(data)[2:length(colnames(data))] <- LETTERS[1:length(colnames(data)) - 1]"
"0","  data <- data[complete.cases(data), ]"
"0",""
"0","  ## -------------------- Computing v/[S] ----------------------- ##"
"0","  if (ncol(data) > 2){"
"0","    tdata <- apply(data[,-1], MARGIN = 2, function(x)  x/data[,1])"
"0","    mean_v <- apply(data[,-1], MARGIN = 1, mean)"
"0","    mean_v_S <- apply(tdata, MARGIN = 1, mean)"
"0","  } else {"
"0","    tdata <- data[,2]/data[,1]"
"0","    mean_v <- data[,2]"
"0","    mean_v_S <- tdata"
"0","  }"
"0",""
"0","  tdata <- as.data.frame(tdata)"
"0","  names(tdata)[1] <- 'v_S'"
"0","  tdata <- cbind(data, tdata)"
"0","  names(tdata)[2] <- 'v'"
"0",""
"0","  nc <- ncol(data) + 1 # number of the first colum for v/S data"
"0",""
"0",""
"0","  ## ------------- Pair-wise intersection and median ----------- ##"
"0","  line.intersect <- function(v, v_S){"
"0","    Kms <- Vms <- c()"
"0","    for (i in 1:(length(v)-1)){"
"0","      for (j in (i+1):length(v)){"
"0","        Km <- (v[j] - v[i])/(v_S[i] - v_S[j])"
"0","        Kms <- c(Kms, Km)"
"0","        Vm <- (v_S[i]*(v[j] - v[i])/(v_S[i] - v_S[j])) + v[j]"
"0","        Vms <- c(Vms, Vm)"
"0","      }"
"0","    }"
"0","    Km <- median(Kms, na.rm = TRUE)"
"0","    Vm <- median(Vms, na.rm = TRUE)"
"0","    return(c(Km, Vm))"
"0","  }"
"0","  ## ------------------------------------------------------------ ##"
"0",""
"0","  ## --------------------- Estimating Km and Vm ----------------- ##"
"0","  Kms <- Vms <- c()"
"0","  c <- 0"
"0","  for (i in 2:(nc - 1)){"
"0","    p <- line.intersect(tdata[,i], tdata[,nc + c])"
"0","    Kms <- c(p[1], Kms)"
"0","    Vms <- c(p[2], Vms)"
"0","    c <- c + 1"
"0","  }"
"0","  Km <- paste('Km: ', round(mean(Kms), 3), ' \u00b1 ', round(sd(Kms), 3), ' ', unit_S)"
"0","  Vm <- paste('Vm: ', round(mean(Vms), 3), ' \u00b1 ', round(sd(Vms), 3), ' ', unit_v)"
"0","  fitted_parameters <- c(round(mean(Kms, na.rm = TRUE), 3),  round(mean(Vms, na.rm = TRUE), 3))"
"0","  names(fitted_parameters) <- c('Km', 'Vm')"
"0",""
"0","  ## --------------------- Plotting results --------------------- ##"
"0","  if (plot){"
"0","    plot(0, 0, ty = 'n',"
"0","         xlim = c(-tdata$S[nrow(tdata)], tdata$S[nrow(tdata)]),"
"0","         ylim = c(0, 3*max(tdata$v, na.rm = TRUE)),"
"0","         xlab = paste(""Km ("", unit_S, "")"", sep = """"),"
"0","         ylab = paste(""Vm ("", unit_v, "")"", sep = """"))"
"0",""
"0","    for (i in 1:nrow(tdata)){"
"0","      points(c(0, -tdata$S[i]), c(mean_v[i], 0), pch = 20)"
"0","      abline(mean_v[i], mean_v_S[i])"
"0","    }"
"0","    abline(v = 0, lty = 2)"
"0","    abline(h = 0, lty = 2)"
"0","  }"
"0",""
"0","  output <- list(fitted_parameters, Km, Vm)"
"0","  names(output) <- c('fitted_parameters', 'Km', 'Vm')"
"0","  return(output)"
"0","}"
